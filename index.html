<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ãƒ¡ãƒ«ã‚«ãƒªå£²ä¸Šç®¡ç†</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root {
  --bg: #f3f4f6;
  --card: #ffffff;
  --primary: #2563eb;
  --green: #16a34a;
  --purple: #7c3aed;
  --pink: #db2777;
  --border: #e5e7eb;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI";
  background: var(--bg);
  height: 100vh;
  display: flex;
}
.layout {
  display: grid;
  grid-template-columns: 420px auto;
  width: 100%;
  height: 100vh;
}
@media(max-width: 768px){
  body{display:block;}
  .layout{display:block;height:auto;}
  .sidebar{width:100%;}
  .main{width:100%;height:auto;}
}
.sidebar {
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:14px;
  background:#fff;
  border-right:2px solid var(--border);
  overflow-y:auto;
}
header h1{font-size:1.35rem;font-weight:bold;margin:0;}
.card {
  background:var(--card);
  border-radius:14px;
  padding:16px;
  border:1px solid var(--border);
}
.form-grid{display:grid;gap:10px;}
.field input{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid var(--border);
}
.stats{display:grid;gap:10px;}
.stat-card{color:#fff;padding:10px;border-radius:12px;text-align:center;font-weight:bold;}
.stat-card span{display:block;font-size:1.3rem;}
.stat-1{background:var(--primary);}
.stat-2{background:var(--green);}
.stat-3{background:var(--purple);}
.stat-4{background:var(--pink);}

.main{overflow-y:auto;padding:14px;}
table{
  width:100%;
  background:#fff;
  border-collapse:collapse;
  border-radius:14px;
  overflow:hidden;
}
thead{background:var(--primary);color:#fff;}
th,td{
  padding:7px 10px;
  border-bottom:1px solid var(--border);
  white-space:nowrap;
}
td:first-child,th:first-child{text-align:left;}
tr:hover{background:#f1f5f9;cursor:pointer;}
</style>
</head>

<body>
<div class="layout">

<div class="sidebar">
<header><h1>ãƒ¡ãƒ«ã‚«ãƒªå£²ä¸Šç®¡ç†</h1></header>

<section class="card">
  <div class="form-grid">
    <div class="field"><input id="name" placeholder="å•†å“å"></div>
    <div class="field"><input id="price" type="number" placeholder="è²©å£²ä¾¡æ ¼"></div>
    <div class="field"><input id="feePercent" type="number" placeholder="æ‰‹æ•°æ–™(%)"></div>
    <div class="field"><input id="shipping" type="number" placeholder="é€æ–™"></div>
    <div class="field"><input id="other" type="number" placeholder="ä»–è²»ç”¨"></div>
    <div class="field"><input id="date" type="date"></div>
  </div>
  <button id="add-row" style="width:100%;margin-top:10px;padding:10px;background:var(--primary);color:#fff;border:none;border-radius:10px;cursor:pointer;">è¿½åŠ å…¥åŠ›</button>
</section>

<section class="stats">
  <div class="stat-card stat-1">ä»¶æ•°<span id="count">0</span></div>
  <div class="stat-card stat-2">å£²ä¸Šç·é¡<span id="sum-sales">0</span></div>
  <div class="stat-card stat-3">ç´”åˆ©ç›Š<span id="sum-profit">0</span></div>
  <div class="stat-card stat-4">åˆ©ç›Šç‡<span id="profit-rate">0%</span></div>
</section>

<section class="card" style="display:grid;gap:8px;">
  <button id="export-csv" style="padding:10px;background:#059669;color:#fff;border:none;border-radius:10px;">ğŸ’¾ CSVå‡ºåŠ›</button>
  <button id="export-xlsx" style="padding:10px;background:#7c3aed;color:#fff;border:none;border-radius:10px;">ğŸ“Š Excelå‡ºåŠ›</button>
</section>

</div>


<div class="main">

<section class="card" style="margin-bottom:14px;">
<button id="toggle-chart" style="width:100%;background:#1d4ed8;color:#fff;padding:8px;border:none;border-radius:10px;margin-bottom:10px;">
ğŸ“ˆ ã‚°ãƒ©ãƒ•è¡¨ç¤º / éè¡¨ç¤º
</button>
<canvas id="salesChart" style="display:none;"></canvas>
</section>

<table>
<thead>
<tr>
<th>å•†å“å</th><th>ä¾¡æ ¼</th><th>æ‰‹æ•°æ–™</th><th>é€æ–™</th><th>ä»–è²»ç”¨</th><th>åˆ©ç›Š</th><th>æ—¥ä»˜</th>
</tr>
</thead>
<tbody id="table-body"></tbody>
</table>

</div>
</div>


<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="editModal" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;">
  <div style="background:white;padding:20px;border-radius:10px;display:grid;gap:10px;width:300px;">
    <h3>ç·¨é›†</h3>
    <input id="edit-name">
    <input id="edit-price" type="number">
    <input id="edit-fee" type="number">
    <input id="edit-shipping" type="number">
    <input id="edit-other" type="number">
    <input id="edit-date" type="date">
    <div style="display:flex;gap:10px;">
      <button id="save-edit" style="flex:1;background:#2563eb;color:white;border:none;padding:10px;border-radius:8px;">ä¿å­˜</button>
      <button id="delete-row" style="flex:1;background:#dc2626;color:white;border:none;padding:10px;border-radius:8px;">å‰Šé™¤</button>
    </div>
    <button id="closeModal" style="background:#eee;padding:8px;border:none;border-radius:8px;">é–‰ã˜ã‚‹</button>
  </div>
</div>


<script>
const STORAGE_KEY="mercariSales_v5";
let editIndex=null;
const $=id=>document.getElementById(id);
const yen=v=>Number(v).toLocaleString("ja-JP");

const initialData=[
["ãƒã‚§ãƒ³ã‚½ãƒ¼ãƒãƒ³",4100,10,750,0,"2025-10-14"],
["ãƒ—ãƒ³ãƒ—ãƒ³å…¨å·»",5100,10,850,0,"2025-10-16"],
["iPhone6",3000,10,210,0,"2025-10-17"],
["Catcher Rye",500,10,210,0,"2025-10-17"],
["æµ·è¾ºã®ã‚«ãƒ•ã‚«",700,10,450,0,"2025-10-17"],
["è‹±æ¤œæº–1ç´š",800,10,210,0,"2025-10-17"],
["Distinction",1600,10,210,0,"2025-10-18"],
["UX100åŸå‰‡",1600,10,210,0,"2025-10-19"],
["CRIMIE",6000,10,750,0,"2025-10-20"],
["é«˜æ ¡ç”Ÿç‰©6å†Š",5000,10,750,0,"2025-10-20"],
["äº¬å¤§æ•°å­¦",980,10,210,0,"2025-10-20"],
["WPæ•™ç§‘æ›¸",2100,10,750,0,"2025-10-22"],
["TOEFL270",1000,10,210,0,"2025-10-22"],
["HTMLCSS",900,10,210,0,"2025-10-23"],
["å¤æ–‡45",450,10,210,0,"2025-10-26"],
["äº¬å¤§å›½èª",980,10,210,0,"2025-10-28"],
["Agriculture",710,10,210,0,"2025-10-30"],
["äº¬å¤§è‹±èª",980,10,210,0,"2025-10-31"],
["äº¬å¤§è‹±èª2",980,10,210,0,"2025-10-31"],
["XM5ã‚±ãƒ¼ã‚¹",1700,10,750,0,"2025-11-01"],
["DMC HD",1200,10,210,0,"2025-11-03"],
["è‹±æ–‡å•é¡Œç²¾è¬›",700,10,210,0,"2025-11-03"],
["iPad8",19000,10,750,0,"2025-11-04"],
["æ•°å­¦1å¯¾1",3400,10,750,0,"2025-11-04"],
["ç†ç³»æ•°å­¦",880,10,210,0,"2025-11-04"],
["GT7",3800,10,210,0,"2025-11-11"],
["BOSS CS3",7500,10,750,0,"2025-11-14"],
["å¯Œå£«é€šWin11",12000,10,850,0,"2025-11-21"]
];

let data=[];

function compute(d){
const [n,p,fp,s,o,date]=d;
const fee=Math.round(p*(fp/100));
const profit=p-fee-s-o;
return {name:n,price:p,fee,shipping:s,other:o,profit,date};
}

function load(){
const saved=localStorage.getItem(STORAGE_KEY);
data = saved ? JSON.parse(saved) : initialData.map(compute);
render();
}

function save(){
localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function render(){
data.sort((a,b)=>a.date.localeCompare(b.date));
let tb=$("table-body");
tb.innerHTML="";
let ts=0,tp=0;

data.forEach((r,i)=>{
ts+=r.price;tp+=r.profit;
tb.innerHTML+=`
<tr data-i="${i}">
<td>${r.name}</td><td>${yen(r.price)}</td><td>${yen(r.fee)}</td>
<td>${yen(r.shipping)}</td><td>${yen(r.other)}</td><td>${yen(r.profit)}</td>
<td>${r.date}</td></tr>`;
});

$("count").textContent=data.length;
$("sum-sales").textContent=yen(ts);
$("sum-profit").textContent=yen(tp);
$("profit-rate").textContent= ts ? Math.round(tp/ts*100)+"%" : "0%";
bindTableEvents();
}

function add(){
const n=$("name").value.trim();
const p=+$("price").value;
const fp=+$("feePercent").value||0;
const s=+$("shipping").value||0;
const o=+$("other").value||0;
const d=$("date").value;
if(!n||!p||!d)return alert("å¿…é ˆï¼");
data.push(compute([n,p,fp,s,o,d]));
save();render();
$("name").value=$("price").value=$("feePercent").value=$("shipping").value=$("other").value="";
}

function bindTableEvents(){
document.querySelectorAll("tbody tr").forEach(tr=>{
tr.onclick=()=>{
editIndex=+tr.dataset.i;
const r=data[editIndex];
$("edit-name").value=r.name;
$("edit-price").value=r.price;
$("edit-fee").value=r.fee;
$("edit-shipping").value=r.shipping;
$("edit-other").value=r.other;
$("edit-date").value=r.date;
$("editModal").style.display="flex";
};
});
}

$("closeModal").onclick=()=>$("editModal").style.display="none";
$("save-edit").onclick=()=>{
let r=data[editIndex];
r.name=$("edit-name").value;
r.price=+$("edit-price").value;
r.fee=+$("edit-fee").value;
r.shipping=+$("edit-shipping").value;
r.other=+$("edit-other").value;
r.profit=r.price-r.fee-r.shipping-r.other;
r.date=$("edit-date").value;
save();render();
$("editModal").style.display="none";
};
$("delete-row").onclick=()=>{
data.splice(editIndex,1);
save();render();
$("editModal").style.display="none";
};

$("add-row").onclick=add;

let chartInstance=null;
function renderChart(){
const ctx=$("salesChart");
const ms={},mp={};
for(const r of data){
const ym=r.date.slice(0,7);
ms[ym]=(ms[ym]||0)+r.price;
mp[ym]=(mp[ym]||0)+r.profit;
}
const labels=Object.keys(ms),sales=labels.map(l=>ms[l]),profits=labels.map(l=>mp[l]);
if(chartInstance)chartInstance.destroy();
chartInstance=new Chart(ctx,{
type:"line",
data:{labels,datasets:[
{label:"å£²ä¸Š",borderColor:"#2563eb",data:sales},
{label:"åˆ©ç›Š",borderColor:"#16a34a",data:profits}
]},
options:{plugins:{legend:{position:"bottom"}}}
});
}

$("toggle-chart").onclick=()=>{
const cv=$("salesChart");
const show=cv.style.display!=="block";
cv.style.display=show?"block":"none";
if(show)renderChart();
};

$("export-csv").onclick=()=>{
let csv="å•†å“å,ä¾¡æ ¼,æ‰‹æ•°æ–™,é€æ–™,ä»–è²»ç”¨,åˆ©ç›Š,æ—¥ä»˜\n";
data.forEach(r=>csv+=`${r.name},${r.price},${r.fee},${r.shipping},${r.other},${r.profit},${r.date}\n`);
const blob=new Blob(["\ufeff"+csv],{type:"text/csv"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);a.download="sales.csv";a.click();
};
$("export-xlsx").onclick=()=>{
const rows=[["å•†å“å","ä¾¡æ ¼","æ‰‹æ•°æ–™","é€æ–™","ä»–è²»ç”¨","åˆ©ç›Š","æ—¥ä»˜"]];
data.forEach(r=>rows.push([r.name,r.price,r.fee,r.shipping,r.other,r.profit,r.date]));
const ws=XLSX.utils.aoa_to_sheet(rows);
const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Sales");
XLSX.writeFile(wb,"sales.xlsx");
};

document.addEventListener("DOMContentLoaded",load);
</script>

</body></html>

